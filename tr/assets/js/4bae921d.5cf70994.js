"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[665],{3617:(i,n,e)=>{e.r(n),e.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>V,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"hardware/nvidia","title":"NixOS Nvidia","description":"nvidia.nix nixpkgs default.nix:","source":"@site/nixos/hardware/nvidia.md","sourceDirName":"hardware","slug":"/hardware/nvidia","permalink":"/Folkillia/tr/nixos/hardware/nvidia","draft":false,"unlisted":false,"editUrl":"https://github.com/1337xxxLucyF3rxxx1337/Folkillia/nixos/hardware/nvidia.md","tags":[{"inline":true,"label":"nvidia","permalink":"/Folkillia/tr/nixos/tags/nvidia"},{"inline":true,"label":"nixos","permalink":"/Folkillia/tr/nixos/tags/nixos"}],"version":"current","lastUpdatedBy":"Thekilla","lastUpdatedAt":1749354514000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"NixOS Nvidia","tags":["nvidia","nixos"]},"sidebar":"defaultSidebar","previous":{"title":"NixOS Troubleshooting","permalink":"/Folkillia/tr/nixos/troubleshoots"}}');var o=e(4848),r=e(8453);const l={sidebar_position:1,title:"NixOS Nvidia",tags:["nvidia","nixos"]},a=void 0,s={},d=[{value:"nvidia.nix nixpkgs default.nix:",id:"nvidianix-nixpkgs-defaultnix",level:2},{value:"How to open vaapi on nvidia?",id:"how-to-open-vaapi-on-nvidia",level:2},{value:"How to check is it working?",id:"how-to-check-is-it-working",level:3}];function c(i){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...i.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"nvidianix-nixpkgs-defaultnix",children:"nvidia.nix nixpkgs default.nix:"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["[!Info] This links include how nvidia package work. I mean, what patches, version etc. by nix code.\n",(0,o.jsx)(n.a,{href:"https://github.com/NixOS/nixpkgs/blob/nixpkgs-unstable/pkgs/os-specific/linux/nvidia-x11/default.nix",children:"unstable-nvidia"}),"\nLearned how to get specific version from above code by ",(0,o.jsx)(n.a,{href:"https://github.com/TLATER/dotfiles/blob/master/nixos-config/hosts/yui/nvidia/default.nix",children:"TLATER"})," dotfiles."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"how-to-open-vaapi-on-nvidia",children:"How to open vaapi on nvidia?"}),"\n",(0,o.jsx)(n.h3,{id:"how-to-check-is-it-working",children:"How to check is it working?"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://github.com/elFarto/nvidia-vaapi-driver?tab=readme-ov-file#building",children:"https://github.com/elFarto/nvidia-vaapi-driver?tab=readme-ov-file#building"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Hardware decoding only, encoding is ",(0,o.jsx)(n.a,{href:"https://github.com/elFarto/nvidia-vaapi-driver/issues/116",children:"not supported"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Nix command","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"nix-shell -p libva-utils --run vainfo"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["nvidia-smi","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Running nvidia-smi while decoding a video should show a Firefox process with C in the Type column. In addition nvidia-smi pmon will show the usage of the decode engine per-process, and nvidia-smi dmon will show the usage per-GPU. When using nvidia open gpu kernel modules, the usage of the decode engine may not be displayed correctly."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"VAEntrypointVLD"})," means that your card is capable to decode this format, ",(0,o.jsx)(n.code,{children:"VAEntrypointEncSlice"})," means that you can encode to this format."]}),"\n",(0,o.jsx)(n.li,{children:"mine:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"Trying display: wayland\nTrying display: x11\nlibva info: VA-API version 1.22.0\nlibva info: Trying to open /run/opengl-driver/lib/dri/nvidia_drv_video.so\nlibva info: Found init function __vaDriverInit_1_0\nlibva info: va_openDriver() returns 0\nvainfo: VA-API version: 1.22 (libva 2.22.0)\nvainfo: Driver version: VA-API NVDEC driver [direct backend]\nvainfo: Supported profile and entrypoints\n      VAProfileMPEG2Simple            :\tVAEntrypointVLD\n      VAProfileMPEG2Main              :\tVAEntrypointVLD\n      VAProfileVC1Simple              :\tVAEntrypointVLD\n      VAProfileVC1Main                :\tVAEntrypointVLD\n      VAProfileVC1Advanced            :\tVAEntrypointVLD\n      VAProfileH264Main               :\tVAEntrypointVLD\n      VAProfileH264High               :\tVAEntrypointVLD\n      VAProfileH264ConstrainedBaseline:\tVAEntrypointVLD\n      VAProfileHEVCMain               :\tVAEntrypointVLD\n      VAProfileVP8Version0_3          :\tVAEntrypointVLD\n      VAProfileVP9Profile0            :\tVAEntrypointVLD\n      VAProfileHEVCMain10             :\tVAEntrypointVLD\n      VAProfileHEVCMain12             :\tVAEntrypointVLD\n      VAProfileVP9Profile2            :\tVAEntrypointVLD\n      VAProfileHEVCMain444            :\tVAEntrypointVLD\n      VAProfileHEVCMain444_10         :\tVAEntrypointVLD\n      VAProfileHEVCMain444_12         :\tVAEntrypointVLD\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Example:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"libva info: VA-API version 0.39.4\nlibva info: va_getDriverName() returns 0\nlibva info: Trying to open /usr/lib/dri/i965_drv_video.so\nlibva info: Found init function __vaDriverInit_0_39\nlibva info: va_openDriver() returns 0\nvainfo: VA-API version: 0.39 (libva 1.7.3)\nvainfo: Driver version: Intel i965 driver for Intel(R) Skylake - 1.7.3\nvainfo: Supported profile and entrypoints\n      VAProfileMPEG2Simple           \xa0:\tVAEntrypointVLD\n      VAProfileMPEG2Simple           \xa0:\tVAEntrypointEncSlice\n      VAProfileMPEG2Main             \xa0:\tVAEntrypointVLD\n      VAProfileMPEG2Main             \xa0:\tVAEntrypointEncSlice\n      VAProfileH264ConstrainedBaseline:\tVAEntrypointVLD\n      VAProfileH264ConstrainedBaseline:\tVAEntrypointEncSlice\n      VAProfileH264ConstrainedBaseline:\tVAEntrypointEncSliceLP\n      VAProfileH264Main              \xa0:\tVAEntrypointVLD\n      VAProfileH264Main              \xa0:\tVAEntrypointEncSlice\n      VAProfileH264Main              \xa0:\tVAEntrypointEncSliceLP\n      VAProfileH264High              \xa0:\tVAEntrypointVLD\n      VAProfileH264High              \xa0:\tVAEntrypointEncSlice\n      VAProfileH264High              \xa0:\tVAEntrypointEncSliceLP\n      VAProfileH264MultiviewHigh     \xa0:\tVAEntrypointVLD\n      VAProfileH264MultiviewHigh     \xa0:\tVAEntrypointEncSlice\n      VAProfileH264StereoHigh        \xa0:\tVAEntrypointVLD\n      VAProfileH264StereoHigh        \xa0:\tVAEntrypointEncSlice\n      VAProfileVC1Simple             \xa0:\tVAEntrypointVLD\n      VAProfileVC1Main               \xa0:\tVAEntrypointVLD\n      VAProfileVC1Advanced           \xa0:\tVAEntrypointVLD\n      VAProfileNone                  \xa0:\tVAEntrypointVideoProc\n      VAProfileJPEGBaseline          \xa0:\tVAEntrypointVLD\n      VAProfileJPEGBaseline          \xa0:\tVAEntrypointEncPicture\n      VAProfileVP8Version0_3         \xa0:\tVAEntrypointVLD\n      VAProfileVP8Version0_3         \xa0:\tVAEntrypointEncSlice\n      VAProfileHEVCMain              \xa0:\tVAEntrypointVLD\n      VAProfileHEVCMain              \xa0:\tVAEntrypointEncSlice\n"})})]})}function V(i={}){const{wrapper:n}={...(0,r.R)(),...i.components};return n?(0,o.jsx)(n,{...i,children:(0,o.jsx)(c,{...i})}):c(i)}},8453:(i,n,e)=>{e.d(n,{R:()=>l,x:()=>a});var t=e(6540);const o={},r=t.createContext(o);function l(i){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof i?i(n):{...n,...i}}),[n,i])}function a(i){let n;return n=i.disableParentContext?"function"==typeof i.components?i.components(o):i.components||o:l(i.components),t.createElement(r.Provider,{value:n},i.children)}}}]);